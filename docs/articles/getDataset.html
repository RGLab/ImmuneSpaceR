<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Downloading Datasets with getDataset • ImmuneSpaceR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Downloading Datasets with getDataset">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ImmuneSpaceR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.7.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Intro_to_ImmuneSpaceR.html">An Introduction to the ImmuneSpaceR Package</a>
    </li>
    <li>
      <a href="../articles/getDataset.html">Downloading Datasets with getDataset</a>
    </li>
    <li>
      <a href="../articles/getGEMatrix.html">Handling Expression Matrices with ImmuneSpaceR</a>
    </li>
    <li>
      <a href="../articles/report_SDY144.html">SDY144: Correlation of HAI/Virus Neutralizition Titer and Cell Counts</a>
    </li>
    <li>
      <a href="../articles/report_SDY180.html">SDY180: Abundance of Plasmablasts Measured by Multiparameter Flow Cytometry</a>
    </li>
    <li>
      <a href="../articles/report_SDY269.html">SDY269: Correlating HAI with Flow Cytometry and ELISPOT Results</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RGLab/ImmuneSpaceR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Downloading Datasets with getDataset</h1>
            
            <h4 class="date">2018-04-10</h4>
      
      <small>Source: <a href="https://github.com/RGLab/ImmuneSpaceR/blob/master/vignettes/getDataset.Rmd"><code>vignettes/getDataset.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p>This vignette shows detailed examples for all functionalities of the <code>getDataset</code> method.</p>
<div id="create-connections" class="section level1">
<h1 class="hasAnchor">
<a href="#create-connections" class="anchor"></a>Create connections</h1>
<p>As explained into the introductory vignette, datasets must be downloaded from <code>ImmuneSpaceConnection</code> objects. We must first instantiate a connection to the study or studies of interest. Throughout this vignette, we will use two connections, one to a single study, and one to to all available data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ImmuneSpaceR)
sdy269 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreateConnection.html">CreateConnection</a></span>(<span class="st">"SDY269"</span>)
all &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreateConnection.html">CreateConnection</a></span>(<span class="st">""</span>)</code></pre></div>
</div>
<div id="list-the-datasets" class="section level1">
<h1 class="hasAnchor">
<a href="#list-the-datasets" class="anchor"></a>List the datasets</h1>
<p>Now that the connections have been instantiated, we can start downloading from themm but we need to figure out which datasets are available within our chosen studies. Printing the connections will, among other information, list the datasets availables. The <code>listDatasets</code> method will display only the information we are looking for.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">listDatasets</a></span>()</code></pre></div>
<pre><code>## datasets
##  demographics
##  elisa
##  gene_expression_files
##  hai
##  cohort_membership
##  pcr
##  fcs_sample_files
##  fcs_analyzed_result
##  elispot
## Expression Matrices
##  LAIV_2008
##  TIV_2008</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">listDatasets</a></span>()</code></pre></div>
<pre><code>## datasets
##  hai
##  fcs_analyzed_result
##  elispot
##  mbaa
##  pcr
##  hla_typing
##  elisa
##  fcs_sample_files
##  gene_expression_files
##  cohort_membership
##  fcs_control_files
##  demographics
##  neut_ab_titer
## Expression Matrices
##  VLplus
##  Fluzone_group1
##  TIV_2007
##  SDY400_youngerAdults
##  VLminus
##  SDY67_batch2
##  LAIV_2008
##  SDY522_LAIVvaccine
##  Saline_group1
##  Fluzone_group2
##  SDY296_AIRFV_2011
##  TIV_older
##  SDY301_AIRFV_2012
##  SDY404_older_PBMC_year2
##  Cohort1_young
##  Saline_group2
##  SDY144_TIV2011
##  pH1N1_2009
##  SDY63_young_PBMC_year1
##  Pneumovax23_group1
##  Pneumovax23_group2
##  TIV_2010
##  SDY404_young_PBMC_year2
##  Cohort2_older
##  SDY63_older_PBMC_year1
##  SDY400_oldAdults
##  TIV_2008
##  TIV_young</code></pre>
<p>Naturally, <code>all</code> contains every dataset available on ImmuneSpace as it combines all available studies. Additionaly, when creating connection object with <code>verbose = TRUE</code>, a call to the <code>getDataset</code> method with an invalid dataset name will return the list of valid datasets.</p>
</div>
<div id="download" class="section level1">
<h1 class="hasAnchor">
<a href="#download" class="anchor"></a>Download</h1>
<p>Calling <code>getDataset</code> returns a selected dataset as it is displayed on ImmuneSpace.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hai_<span class="dv">269</span> &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"hai"</span>)
hai_all &lt;-<span class="st"> </span>all<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"hai"</span>)

<span class="kw">head</span>(hai_<span class="dv">269</span>)</code></pre></div>
<pre><code>##    participant_id age_reported gender                      race
## 1:  SUB112831.269           40   Male Black or African American
## 2:  SUB112858.269           28   Male                     Asian
## 3:  SUB112873.269           25   Male                     White
## 4:  SUB112881.269           29 Female Black or African American
## 5:  SUB112851.269           42 Female                     Asian
## 6:  SUB112875.269           25 Female                     White
##             cohort study_time_collected study_time_collected_unit
## 1: LAIV group 2008                    0                      Days
## 2: LAIV group 2008                    0                      Days
## 3: LAIV group 2008                    0                      Days
## 4: LAIV group 2008                    0                      Days
## 5:  TIV Group 2008                   28                      Days
## 6:  TIV Group 2008                   28                      Days
##                 virus value_reported
## 1:   B/Florida/4/2006              5
## 2:   B/Florida/4/2006              5
## 3:   B/Florida/4/2006              5
## 4:   B/Florida/4/2006              5
## 5: A/Brisbane/59/2007              5
## 6: A/Brisbane/59/2007             80</code></pre>
<p>Because some datasets such as flow cytometry results can contain a large number of rows, the method returns <code>data.table</code> objects to improve performance. This is especially important with multi-study connections.</p>
</div>
<div id="filters" class="section level1">
<h1 class="hasAnchor">
<a href="#filters" class="anchor"></a>Filters</h1>
<p>The datasets can be filtered before download. Filters should be created using <code>Rlabkey</code>’s <code>makeFilter</code> function.</p>
<p>Each filter is composed of three part: * A column name or column label * An operator * A value or array of values separated by a semi-colon</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Rlabkey)</code></pre></div>
<pre><code>## Loading required package: httr</code></pre>
<pre><code>## Loading required package: rjson</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get participants under age of 30</span>
young_filter &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/Rlabkey/topics/makeFilter">makeFilter</a></span>(<span class="kw">c</span>(<span class="st">"age_reported"</span>, <span class="st">"LESS_THAN"</span>, <span class="dv">30</span>))

<span class="co"># Get a specific list of two participants</span>
pid_filter &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/Rlabkey/topics/makeFilter">makeFilter</a></span>(<span class="kw">c</span>(<span class="st">"participantid"</span>, <span class="st">"IN"</span>, <span class="st">"SUB112841.269;SUB112834.269"</span>))</code></pre></div>
<p>For a list of available operators, see <code><a href="http://www.rdocumentation.org/packages/Rlabkey/topics/makeFilter">?Rlabkey::makeFilter</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># HAI data for participants of study SDY269 under age of 30</span>
hai_young &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"hai"</span>, <span class="dt">colFilter =</span> young_filter)

<span class="co"># List of participants under age 30</span>
demo_young &lt;-<span class="st"> </span>all<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"demographics"</span>, <span class="dt">colFilter =</span> young_filter)

<span class="co"># ELISPOT assay results for two participants</span>
mbaa_pid2 &lt;-<span class="st"> </span>all<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"elispot"</span>, <span class="dt">colFilter =</span> pid_filter)</code></pre></div>
<p>Note that filtering is done before download. When performance is a concern, it is faster to do the filtering via the <code>colfFilter</code> argument than on the returned table.</p>
</div>
<div id="views" class="section level1">
<h1 class="hasAnchor">
<a href="#views" class="anchor"></a>Views</h1>
<p>Any dataset grid on ImmuneSpace offers the possibility to switch views between ‘Default’ and ‘Full’. The Default view contains information that is directly relevant to the user. Sample description and results are joined with basic demographic. However, this is not the way data is organized in the database. The ‘Full’ view is a representation of the data as it is stored on <a href="http://www.immport.org/immport-open/public/home/home">ImmPort</a>. The accession columns are used under the hood for join operations. They will be useful to developers and user writing reports to be displayed in ImmuneSpace studies.</p>
<div class="figure">
<img src="img/getDataset-views.png">
</div>
<p>Screen capture of the button bar of a dataset grid on ImmuneSpace.</p>
<p>The <code>original_view</code> argument decides which view is downloaded. If set to <code>TRUE</code>, the ‘Full’ view is returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">full_hai &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"hai"</span>, <span class="dt">original_view =</span> <span class="ot">TRUE</span>)

<span class="kw">colnames</span>(full_hai)</code></pre></div>
<pre><code>##  [1] "participant_id"            "arm_accession"            
##  [3] "biosample_accession"       "expsample_accession"      
##  [5] "experiment_accession"      "study_accession"          
##  [7] "study_time_collected"      "study_time_collected_unit"
##  [9] "virus"                     "value_reported"           
## [11] "value_preferred"           "unit_reported"            
## [13] "unit_preferred"</code></pre>
<p>For additional information, refer to the <a href="https://www.youtube.com/watch?v=69k8DquDK7o">‘Working with tabular data’</a> video tutorial.</p>
</div>
<div id="caching" class="section level1">
<h1 class="hasAnchor">
<a href="#caching" class="anchor"></a>Caching</h1>
<p>As explained in the introductory guide, the <code>ImmuneSpaceConnection</code> class is a <a href="https://cran.r-project.org/web/packages/R6/index.html"><code>R6</code></a> class. It means its objects have fields accessed by reference. As a consequence, they can be modified without making a copy of the entire object. ImmuneSpaceR uses this feature to store downloaded datasets and expression matrices. Subsequent calls to <code>getDataset</code> with the same input will be faster.</p>
<p>See <code><a href="http://www.rdocumentation.org/packages/R6/topics/R6Class">?R6::R6Class</a></code> for more information about R6 class system.</p>
<p>We can see the data currently cached using the <code>cache</code> field. This is not intended to be used for data manipulation and only displayed here to explain what gets cached.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pcr &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"pcr"</span>)
<span class="kw">names</span>(sdy269<span class="op">$</span>cache)</code></pre></div>
<pre><code>## [1] "GE_matrices"</code></pre>
<p>Different views are saved separately.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pcr_ori &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"pcr"</span>, <span class="dt">original_view =</span> <span class="ot">TRUE</span>)
<span class="kw">names</span>(sdy269<span class="op">$</span>cache)</code></pre></div>
<pre><code>## [1] "GE_matrices"</code></pre>
<p>Because of the infinite number of filters and combinations of filters, we do not cache filtered datasets.</p>
<p>If, for any reason, a specific dataset needs to be redownloaded, the <code>reload</code> argument will clear the cache for that specific <code>getDataset</code> call and download the table again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hai_<span class="dv">269</span> &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getDataset</a></span>(<span class="st">"hai"</span>, <span class="dt">reload =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Finally, it is possible to clear every cached dataset (and expression matrix).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sdy269<span class="op">$</span><span class="kw">clearCache</span>()
<span class="kw">names</span>(sdy269<span class="op">$</span>cache)</code></pre></div>
<pre><code>## [1] "GE_matrices"</code></pre>
<p>Again, the <code>cache</code> field should never be modified manually. When in doubt, simply reload the dataset.</p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.4.4 (2018-03-15)
## Platform: x86_64-apple-darwin17.3.0 (64-bit)
## Running under: macOS High Sierra 10.13.4
## 
## Matrix products: default
## BLAS: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] Rlabkey_2.2.1      rjson_0.2.15       httr_1.3.1        
## [4] ImmuneSpaceR_1.7.3 knitr_1.20        
## 
## loaded via a namespace (and not attached):
##  [1] Biobase_2.38.0        viridis_0.5.1         tidyr_0.8.0          
##  [4] foreach_1.4.4         jsonlite_1.5          viridisLite_0.3.0    
##  [7] gtools_3.5.0          assertthat_0.2.0      stats4_3.4.4         
## [10] yaml_2.1.18           robustbase_0.92-8     pillar_1.2.1         
## [13] backports_1.1.2       lattice_0.20-35       glue_1.2.0           
## [16] digest_0.6.15         RColorBrewer_1.1-2    colorspace_1.3-2     
## [19] preprocessCore_1.40.0 htmltools_0.3.6       plyr_1.8.4           
## [22] pkgconfig_2.0.1       pheatmap_1.0.8        purrr_0.2.4          
## [25] mvtnorm_1.0-7         scales_0.5.0          webshot_0.5.0        
## [28] gdata_2.18.0          whisker_0.3-2         tibble_1.4.2         
## [31] ggplot2_2.2.1         nnet_7.3-12           BiocGenerics_0.24.0  
## [34] lazyeval_0.2.1        magrittr_1.5          crayon_1.3.4         
## [37] mclust_5.4            memoise_1.1.0         heatmaply_0.14.1     
## [40] evaluate_0.10.1       fs_1.2.2              MASS_7.3-49          
## [43] gplots_3.0.1          xml2_1.2.0            class_7.3-14         
## [46] registry_0.5          tools_3.4.4           data.table_1.10.4-3  
## [49] trimcluster_0.1-2     stringr_1.3.0         plotly_4.7.1         
## [52] kernlab_0.9-25        munsell_0.4.3         cluster_2.0.7-1      
## [55] fpc_2.1-11            bindrcpp_0.2.2        compiler_3.4.4       
## [58] pkgdown_0.1.0.9000    caTools_1.17.1        rlang_0.2.0          
## [61] grid_3.4.4            iterators_1.0.9       rstudioapi_0.7       
## [64] htmlwidgets_1.0       bitops_1.0-6          rmarkdown_1.9        
## [67] codetools_0.2-15      gtable_0.2.0          curl_3.2             
## [70] flexmix_2.3-14        roxygen2_6.0.1        reshape2_1.4.3       
## [73] TSP_1.1-5             R6_2.2.2              seriation_1.2-3      
## [76] gridExtra_2.3         prabclus_2.2-6        dplyr_0.7.4          
## [79] bindr_0.1.1           commonmark_1.4        rprojroot_1.3-2      
## [82] KernSmooth_2.23-15    dendextend_1.7.0      desc_1.1.1           
## [85] modeltools_0.2-21     stringi_1.1.7         parallel_3.4.4       
## [88] Rcpp_0.12.16          gclus_1.3.1           DEoptimR_1.0-8       
## [91] diptest_0.75-7</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#create-connections">Create connections</a></li>
      <li><a href="#list-the-datasets">List the datasets</a></li>
      <li><a href="#download">Download</a></li>
      <li><a href="#filters">Filters</a></li>
      <li><a href="#views">Views</a></li>
      <li><a href="#caching">Caching</a></li>
      <li><a href="#session-info">Session info</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Greg Finak, Renan Sauteraud, Mike Jiang, Gil Guday, Leo Dashevskiy, Evan Henrich, Ju Yeong Kim, Raphael Gottardo, ImmuneSpace Package Maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
