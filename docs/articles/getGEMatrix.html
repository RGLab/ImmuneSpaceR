<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handling Expression Matrices with ImmuneSpaceR â€¢ ImmuneSpaceR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Handling Expression Matrices with ImmuneSpaceR">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ImmuneSpaceR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.7.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Intro_to_ImmuneSpaceR.html">An Introduction to the ImmuneSpaceR Package</a>
    </li>
    <li>
      <a href="../articles/getDataset.html">Downloading Datasets with getDataset</a>
    </li>
    <li>
      <a href="../articles/getGEMatrix.html">Handling Expression Matrices with ImmuneSpaceR</a>
    </li>
    <li>
      <a href="../articles/report_SDY144.html">SDY144: Correlation of HAI/Virus Neutralizition Titer and Cell Counts</a>
    </li>
    <li>
      <a href="../articles/report_SDY180.html">SDY180: Abundance of Plasmablasts Measured by Multiparameter Flow Cytometry</a>
    </li>
    <li>
      <a href="../articles/report_SDY269.html">SDY269: Correlating HAI with Flow Cytometry and ELISPOT Results</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RGLab/ImmuneSpaceR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Handling Expression Matrices with ImmuneSpaceR</h1>
                        <h4 class="author">Renan Sauteraud</h4>
            
            <h4 class="date">2018-04-10</h4>
      
      <small>Source: <a href="https://github.com/RGLab/ImmuneSpaceR/blob/master/vignettes/getGEMatrix.Rmd"><code>vignettes/getGEMatrix.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p>This vignette shows detailed examples for the <code><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix()</a></code> method</p>
<div id="create-connections" class="section level1">
<h1 class="hasAnchor">
<a href="#create-connections" class="anchor"></a>Create connections</h1>
<p>As explained into the introductory vignette, datasets must be downloaded from <code>ImmuneSpaceConnection</code> objects. We must first instantiate a connection to the study or studies of interest. Throughout this vignette, we will use two connections, one to a single study, and one to to all available data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ImmuneSpaceR)
sdy269 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreateConnection.html">CreateConnection</a></span>(<span class="st">"SDY269"</span>)
all &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreateConnection.html">CreateConnection</a></span>(<span class="st">""</span>)</code></pre></div>
</div>
<div id="list-the-expression-matrices" class="section level1">
<h1 class="hasAnchor">
<a href="#list-the-expression-matrices" class="anchor"></a>List the expression matrices</h1>
<p>Now that the connections have been instantiated, we can start downloading from them. But we need to figure out which processed matrices are available within our chosen studies.</p>
<p>On the ImmuneSpace portal, in the study of interest or at the project level, the <strong>Gene expression matrices</strong> table will show the available runs.</p>
<p>Printing the connections will, among other information, list the datasets availables. The <code>listDatasets</code> method will only display the downloadable data. looking for. With <code>output = "expression"</code>, the datasets wont be printed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">listDatasets</a></span>()</code></pre></div>
<pre><code>## datasets
##  demographics
##  elisa
##  gene_expression_files
##  hai
##  cohort_membership
##  pcr
##  fcs_sample_files
##  fcs_analyzed_result
##  elispot
## Expression Matrices
##  LAIV_2008
##  TIV_2008</code></pre>
<p>Using <code>output = "expression"</code>, we can remove the datasets from the output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">listDatasets</a></span>(<span class="dt">output =</span> <span class="st">"expression"</span>)</code></pre></div>
<pre><code>## Expression Matrices
##  VLplus
##  Fluzone_group1
##  TIV_2007
##  SDY400_youngerAdults
##  VLminus
##  SDY67_batch2
##  LAIV_2008
##  SDY522_LAIVvaccine
##  Saline_group1
##  Fluzone_group2
##  SDY296_AIRFV_2011
##  TIV_older
##  SDY301_AIRFV_2012
##  SDY404_older_PBMC_year2
##  Cohort1_young
##  Saline_group2
##  SDY144_TIV2011
##  pH1N1_2009
##  SDY63_young_PBMC_year1
##  Pneumovax23_group1
##  Pneumovax23_group2
##  TIV_2010
##  SDY404_young_PBMC_year2
##  Cohort2_older
##  SDY63_older_PBMC_year1
##  SDY400_oldAdults
##  TIV_2008
##  TIV_young</code></pre>
<p>Naturally, <code>all</code> contains every processed matrices available on ImmuneSpace as it combines all available studies.</p>
</div>
<div id="download" class="section level1">
<h1 class="hasAnchor">
<a href="#download" class="anchor"></a>Download</h1>
<div id="by-run-name" class="section level2">
<h2 class="hasAnchor">
<a href="#by-run-name" class="anchor"></a>By run name</h2>
<p>The <code>getGEMatrix</code> method will accept any of the run names listed in the connection.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TIV_<span class="dv">2008</span> &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix</a></span>(<span class="st">"TIV_2008"</span>)</code></pre></div>
<pre><code>## Downloading matrix..</code></pre>
<pre><code>## Constructing ExpressionSet</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TIV_<span class="dv">2011</span> &lt;-<span class="st"> </span>all<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix</a></span>(<span class="dt">matrixName =</span> <span class="st">"SDY144_TIV2011"</span>)</code></pre></div>
<pre><code>## Downloading matrix..
## Constructing ExpressionSet</code></pre>
<p>The matrices are returned as <code>ExpressionSet</code> where the phenoData slot contains basic demographic information and the featureData slot shows a mapping of probe to official gene symbols.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TIV_<span class="dv">2008</span></code></pre></div>
<pre><code>## ExpressionSet (storageMode: lockedEnvironment)
## assayData: 16729 features, 80 samples 
##   element names: exprs 
## protocolData: none
## phenoData
##   sampleNames: BS586131 BS586187 ... BS586267 (80 total)
##   varLabels: study_time_collected study_time_collected_unit ...
##     biosample_accession (5 total)
##   varMetadata: labelDescription
## featureData
##   featureNames: DDR1 RFC2 ... NUS1P3 (16729 total)
##   fvarLabels: FeatureId gene_symbol
##   fvarMetadata: labelDescription
## experimentData: use 'experimentData(object)'
## Annotation:</code></pre>
</div>
<div id="by-cohort" class="section level2">
<h2 class="hasAnchor">
<a href="#by-cohort" class="anchor"></a>By cohort</h2>
<p>The <code>cohort</code> argument can be used in place of the run name (<code>x</code>). Likewise, the list of valid cohorts can be found in the Gene expression matrices table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LAIV_<span class="dv">2008</span> &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix</a></span>(<span class="dt">cohort =</span> <span class="st">"LAIV group 2008"</span>)</code></pre></div>
<pre><code>## Downloading matrix..</code></pre>
<pre><code>## Constructing ExpressionSet</code></pre>
<p>Note that when cohort is used, <code>x</code> is ignored.</p>
</div>
</div>
<div id="summarized-matrices" class="section level1">
<h1 class="hasAnchor">
<a href="#summarized-matrices" class="anchor"></a>Summarized matrices</h1>
<p>By default, the returned <code>ExpressionSet</code>s have probe names as features (or rows). However, multiple probes often match the same gene and merging experiments from different arrays is impossible at feature level. When they are available, the <code>summary</code> argument allows to return the matrices with gene symbols instead of probes. You should use <code>currAnno</code> set to <code>TRUE</code> to use the latest official gene symbols mapped for each probe, but you can also set this to <code>FALSE</code> to retrieve the original mappings from when the matrix was created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TIV_2008_sum &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix</a></span>(<span class="st">"TIV_2008"</span>, <span class="dt">outputType =</span> <span class="st">"summary"</span>, <span class="dt">annotation =</span> <span class="st">"latest"</span>)</code></pre></div>
<pre><code>## returning TIV_2008_sum_eset from cache</code></pre>
<p>Probes that do not map to a unique gene are removed and expression is averaged by gene.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TIV_2008_sum</code></pre></div>
<pre><code>## ExpressionSet (storageMode: lockedEnvironment)
## assayData: 16729 features, 80 samples 
##   element names: exprs 
## protocolData: none
## phenoData
##   sampleNames: BS586131 BS586187 ... BS586267 (80 total)
##   varLabels: study_time_collected study_time_collected_unit ...
##     biosample_accession (5 total)
##   varMetadata: labelDescription
## featureData
##   featureNames: DDR1 RFC2 ... NUS1P3 (16729 total)
##   fvarLabels: FeatureId gene_symbol
##   fvarMetadata: labelDescription
## experimentData: use 'experimentData(object)'
## Annotation:</code></pre>
</div>
<div id="combining-matrices" class="section level1">
<h1 class="hasAnchor">
<a href="#combining-matrices" class="anchor"></a>Combining matrices</h1>
<p>In order to faciliate analysis across experiments and studies, when multiple runs or cohorts are specified, <code>getGEMatrix</code> will attempt to combine the selected expression matrices into a single <code>ExpressionSet</code>.</p>
<p>To avoid returning an empty object, it is usually recommended to use the summarized version of the matrices, thus combining by genes. This is almost always necessary when combining data from multiple studies.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Within a study</span>
em269 &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix</a></span>(<span class="kw">c</span>(<span class="st">"TIV_2008"</span>, <span class="st">"LAIV_2008"</span>))</code></pre></div>
<pre><code>## returning summary matrix from cache
## returning summary matrix from cache</code></pre>
<pre><code>## returning latest annotation from cache
## returning latest annotation from cache</code></pre>
<pre><code>## Constructing ExpressionSet
## Constructing ExpressionSet</code></pre>
<pre><code>## Combining ExpressionSets</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Combining across studies</span>
TIV_seasons &lt;-<span class="st"> </span>all<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix</a></span>(<span class="kw">c</span>(<span class="st">"TIV_2008"</span>, <span class="st">"SDY144_TIV2011"</span>),
                               <span class="dt">outputType =</span> <span class="st">"summary"</span>,
                               <span class="dt">annotation =</span> <span class="st">"latest"</span>)</code></pre></div>
<pre><code>## Downloading matrix..</code></pre>
<pre><code>## returning summary matrix from cache</code></pre>
<pre><code>## returning latest annotation from cache</code></pre>
<pre><code>## Constructing ExpressionSet
## Constructing ExpressionSet</code></pre>
<pre><code>## Combining ExpressionSets</code></pre>
</div>
<div id="caching" class="section level1">
<h1 class="hasAnchor">
<a href="#caching" class="anchor"></a>Caching</h1>
<p>As explained in the introductory, the <code>ImmuneSpaceConnection</code> class is a <a href="https://cran.r-project.org/web/packages/R6/index.html"><code>R6</code></a> class. It means its objects have fields accessed by reference. As a consequence, they can be modified without making a copy of the entire object. ImmuneSpaceR uses this feature to store downloaded datasets and expression matrices. Subsequent calls to <code>getGEMatrix</code> with the same input will be faster.</p>
<p>See <code><a href="http://www.rdocumentation.org/packages/R6/topics/R6Class">?R6::R6Class</a></code> for more information about R6 class system.</p>
<p>We can see a list of already downloaded runs and feature sets the <code>cache</code> field. This is not intended to be used for data manipulation and only displayed here to explain what gets cached.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(sdy269<span class="op">$</span>cache)</code></pre></div>
<pre><code>## [1] "GE_matrices"        "TIV_2008_sum"       "featureset_18"     
## [4] "TIV_2008_sum_eset"  "LAIV_2008_sum"      "LAIV_2008_sum_eset"</code></pre>
<p>If, for any reason, a specific marix needs to be redownloaded, the <code>reload</code> argument will clear the cache for that specific <code>getGEMatrix</code> call and download the file and metadata again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TIV_<span class="dv">2008</span> &lt;-<span class="st"> </span>sdy269<span class="op">$</span><span class="kw"><a href="../reference/ImmuneSpaceConnection.html">getGEMatrix</a></span>(<span class="st">"TIV_2008"</span>, <span class="dt">reload =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## returning summary matrix from cache</code></pre>
<pre><code>## returning latest annotation from cache</code></pre>
<pre><code>## Constructing ExpressionSet</code></pre>
<p>Finally, it is possible to clear every cached expression matrix (and dataset).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sdy269<span class="op">$</span><span class="kw">clearCache</span>()</code></pre></div>
<p>Again, the <code>cache</code> field should never be modified manually. When in doubt, simply reload the expression matrix.</p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.4.4 (2018-03-15)
## Platform: x86_64-apple-darwin17.3.0 (64-bit)
## Running under: macOS High Sierra 10.13.4
## 
## Matrix products: default
## BLAS: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] ImmuneSpaceR_1.7.3 knitr_1.20        
## 
## loaded via a namespace (and not attached):
##  [1] Biobase_2.38.0        viridis_0.5.1         httr_1.3.1           
##  [4] tidyr_0.8.0           foreach_1.4.4         jsonlite_1.5         
##  [7] viridisLite_0.3.0     gtools_3.5.0          assertthat_0.2.0     
## [10] stats4_3.4.4          yaml_2.1.18           robustbase_0.92-8    
## [13] pillar_1.2.1          backports_1.1.2       lattice_0.20-35      
## [16] glue_1.2.0            digest_0.6.15         RColorBrewer_1.1-2   
## [19] colorspace_1.3-2      preprocessCore_1.40.0 htmltools_0.3.6      
## [22] plyr_1.8.4            pkgconfig_2.0.1       pheatmap_1.0.8       
## [25] purrr_0.2.4           mvtnorm_1.0-7         scales_0.5.0         
## [28] webshot_0.5.0         gdata_2.18.0          whisker_0.3-2        
## [31] tibble_1.4.2          ggplot2_2.2.1         nnet_7.3-12          
## [34] BiocGenerics_0.24.0   lazyeval_0.2.1        magrittr_1.5         
## [37] crayon_1.3.4          mclust_5.4            memoise_1.1.0        
## [40] heatmaply_0.14.1      evaluate_0.10.1       fs_1.2.2             
## [43] MASS_7.3-49           gplots_3.0.1          xml2_1.2.0           
## [46] class_7.3-14          registry_0.5          tools_3.4.4          
## [49] data.table_1.10.4-3   Rlabkey_2.2.1         trimcluster_0.1-2    
## [52] stringr_1.3.0         plotly_4.7.1          kernlab_0.9-25       
## [55] munsell_0.4.3         cluster_2.0.7-1       fpc_2.1-11           
## [58] bindrcpp_0.2.2        compiler_3.4.4        pkgdown_0.1.0.9000   
## [61] caTools_1.17.1        rlang_0.2.0           grid_3.4.4           
## [64] iterators_1.0.9       rstudioapi_0.7        rjson_0.2.15         
## [67] htmlwidgets_1.0       bitops_1.0-6          rmarkdown_1.9        
## [70] codetools_0.2-15      gtable_0.2.0          curl_3.2             
## [73] flexmix_2.3-14        roxygen2_6.0.1        reshape2_1.4.3       
## [76] TSP_1.1-5             R6_2.2.2              seriation_1.2-3      
## [79] gridExtra_2.3         prabclus_2.2-6        dplyr_0.7.4          
## [82] bindr_0.1.1           commonmark_1.4        rprojroot_1.3-2      
## [85] KernSmooth_2.23-15    dendextend_1.7.0      desc_1.1.1           
## [88] modeltools_0.2-21     stringi_1.1.7         parallel_3.4.4       
## [91] Rcpp_0.12.16          gclus_1.3.1           DEoptimR_1.0-8       
## [94] diptest_0.75-7</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#create-connections">Create connections</a></li>
      <li><a href="#list-the-expression-matrices">List the expression matrices</a></li>
      <li>
<a href="#download">Download</a><ul class="nav nav-pills nav-stacked">
<li><a href="#by-run-name">By run name</a></li>
      <li><a href="#by-cohort">By cohort</a></li>
      </ul>
</li>
      <li><a href="#summarized-matrices">Summarized matrices</a></li>
      <li><a href="#combining-matrices">Combining matrices</a></li>
      <li><a href="#caching">Caching</a></li>
      <li><a href="#session-info">Session info</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Greg Finak, Renan Sauteraud, Mike Jiang, Gil Guday, Leo Dashevskiy, Evan Henrich, Ju Yeong Kim, Raphael Gottardo, ImmuneSpace Package Maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
